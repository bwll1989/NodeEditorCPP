# CutImageNode 帮助文档
## 节点功能
CutImageNode 是一个用于裁剪图像的节点，允许用户指定裁剪区域的左上角坐标（X, Y）以及宽度和高度，从而从输入图像中提取指定区域的子图像。该节点具有以下功能：

1. 图像裁剪 ：从输入图像中提取指定矩形区域
2. 参数可视化编辑 ：通过界面控件直接编辑裁剪参数
3. 动态更新 ：参数变化时实时更新输出图像
4. 参数外部控制 ：支持通过输入端口动态设置裁剪参数
5. 配置保存与加载 ：保存和恢复裁剪设置
## 输入端口
CutImageNode 有 5 个输入端口：

1. IMAGE (端口 0)：接收 ImageData 类型数据，即要裁剪的源图像
2. POS_X (端口 1)：接收 VariableData 类型数据，表示裁剪区域左上角的 X 坐标
3. POS_Y (端口 2)：接收 VariableData 类型数据，表示裁剪区域左上角的 Y 坐标
4. WIDTH (端口 3)：接收 VariableData 类型数据，表示裁剪区域的宽度
5. HEIGHT (端口 4)：接收 VariableData 类型数据，表示裁剪区域的高度
## 输出端口
CutImageNode 有 1 个输出端口：

- IMAGE (端口 0)：输出 ImageData 类型数据，即裁剪后的图像
## 节点界面
CutImageNode 提供了一个简洁的用户界面，包含以下控件：

- topleft_X ：输入框，用于设置裁剪区域左上角的 X 坐标
- topleft_Y ：输入框，用于设置裁剪区域左上角的 Y 坐标
- width ：输入框，用于设置裁剪区域的宽度
- height ：输入框，用于设置裁剪区域的高度
所有参数都可以通过界面直接编辑，也可以通过相应的输入端口进行设置。参数变化时，节点会自动重新处理图像并更新输出。

## 使用示例
### 基本图像裁剪
1. 将图像源节点（如 ImageLoadNode 或 CameraNode）的输出连接到 CutImageNode 的 IMAGE 输入端口
2. 在 CutImageNode 的界面中设置裁剪参数：
   - topleft_X: 100（从左边起第 100 个像素开始裁剪）
   - topleft_Y: 50（从顶部起第 50 个像素开始裁剪）
   - width: 300（裁剪区域宽度为 300 像素）
   - height: 200（裁剪区域高度为 200 像素）
3. CutImageNode 将输出一个 300×200 大小的图像，该图像是原图像中从坐标 (100, 50) 开始的矩形区域
### 动态裁剪区域
1. 将图像源节点的输出连接到 CutImageNode 的 IMAGE 输入端口
2. 将 IntSourceNode 节点的输出连接到 CutImageNode 的 POS_X 和 POS_Y 输入端口
3. 将另外两个 IntSourceNode 节点的输出连接到 WIDTH 和 HEIGHT 输入端口
4. 通过调整这些 IntSourceNode 的值，可以动态改变裁剪区域
### 图像跟踪裁剪
1. 将图像源节点的输出连接到 CutImageNode 的 IMAGE 输入端口
2. 使用图像处理节点（如目标检测节点）计算目标对象的位置和大小
3. 将这些位置和大小数据连接到 CutImageNode 的相应输入端口
4. CutImageNode 将根据目标对象的位置和大小动态裁剪图像，实现对目标的跟踪裁剪
## 注意事项
1. 裁剪区域有效性 ：如果设置的宽度或高度小于等于 0，节点将不会输出图像
2. 边界检查 ：节点不会检查裁剪区域是否超出原图像边界，如果超出，Qt 的 QImage::copy() 方法会自动处理，但可能导致裁剪结果不符合预期
3. 空图像处理 ：如果输入图像为空，节点将不会输出图像
4. 数据类型 ：确保连接到 POS_X、POS_Y、WIDTH 和 HEIGHT 端口的数据可以被转换为整数
5. 性能考虑 ：裁剪操作相对轻量，但处理大图像时仍可能影响性能
6. 配置保存 ：节点的裁剪参数会随流程图一起保存和加载
## 技术细节
- QRect ：使用 Qt 的 QRect 类表示裁剪区域
- QImage::copy() ：使用 Qt 的图像复制方法实现裁剪
- 信号槽机制 ：使用 Qt 的信号槽机制实现界面参数变化时的实时更新
- 数据类型转换 ：使用 std::dynamic_pointer_cast 进行数据类型转换
- 持久化 ：使用 QJsonObject 实现配置的保存和加载