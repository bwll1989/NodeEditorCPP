# ArtnetDeviceNode 帮助文档

## 概述

ArtnetDeviceNode是一个抽象化的Artnet灯光设备节点，用于封装和处理Artnet协议数据。该节点支持动态通道数量配置、起始DMX地址设置，并通过输入和输出端口接收和发送Artnet数据。

**主要特性**：
- 支持标准Artnet协议数据封装
- 可配置起始DMX地址（1-512）
- 支持动态通道数量（1-512个DMX通道）
- 提供动态可视化通道控制器（竖向排列）
- 实时生成标准Artnet数据包
- 支持OSC远程控制
- 设备通道编号（CH0开始）与DMX地址分离
- **新增：启用/禁用控制功能**

## 功能说明

### DMX地址管理
- **起始地址**：可设置DMX起始地址（1-512）
- **地址范围**：自动计算并显示地址范围
- **通道映射**：设备通道（CH0-CHn）映射到指定DMX地址范围
- **DMX数据**：支持1-512个DMX通道，每个通道值范围0-255

### 启用/禁用控制
- **启用输出**：复选框控制，默认启用状态
- **启用时**：发送当前设置的通道值到下一级
- **禁用时**：发送0值到下一级，实现快速静音/关闭效果
- **实时切换**：状态改变时立即更新输出数据
- **状态保存**：启用状态随节点配置一起保存和加载

### 端口配置

#### 输入端口（固定16个）
- **CH0-CH15**：对应设备的前16个通道输入
- 接收0-255的整数值
- 超出范围的值会被自动限制
- 只有在通道数量范围内的端口才会处理输入数据
- **启用状态影响**：禁用时所有端口输入都输出0值

#### 输出端口
- **ARTNET**：完整的Artnet数据包和相关信息
  - 包含起始地址、通道数量、结束地址
  - DMX地址到值的映射表
  - 通道数据数组
  - **新增：启用状态标志**

## 界面说明

### 通道配置
- **启用输出**：复选框，控制节点输出状态（默认启用）
- **起始地址**：DMX起始地址设置 (1-512)
- **通道数**：设备通道总数 (1-512)
- **地址范围**：自动显示当前DMX地址范围

### 通道控制（竖向排列）
- **动态通道**：根据通道数量动态创建/销毁控制器
- **设备编号**：显示设备通道编号（CH0, CH1, CH2...）
- **实时显示**：显示当前通道值
- **手动调节**：可通过滑块手动设置通道值
- **滚动支持**：支持滚动查看大量通道
- **状态响应**：禁用时滑块值仍可调节，但输出为0

### 界面布局
- **竖向排列**：所有通道控件竖向依次排列
- **紧凑设计**：每个通道占一行，标签在左，滑块在右
- **自适应高度**：根据通道数量自动调整界面高度
- **滚动区域**：超出显示区域时提供滚动功能

## 使用示例

### 示例1：基本灯光控制
1. 设置起始DMX地址（如：1）
2. 设置所需的通道数量（如：8个通道）
3. 确保"启用输出"复选框已选中
4. 通过输入端口或界面滑块设置通道值
5. 从ARTNET输出端口获取封装好的数据
6. 地址范围将显示为：1-8

### 示例2：快速静音控制
1. 在演出过程中需要快速关闭某个设备
2. 取消选中"启用输出"复选框
3. 设备立即输出0值，实现静音效果
4. 重新选中复选框即可恢复正常输出
5. 通道值设置保持不变，只是输出被控制

### 示例3：多设备配置
1. 第一个设备：起始地址1，通道数8（占用DMX 1-8）
2. 第二个设备：起始地址9，通道数16（占用DMX 9-24）
3. 第三个设备：起始地址25，通道数4（占用DMX 25-28）
4. 可独立控制每个设备的启用/禁用状态

### 示例4：与其他节点配合
- **LFO节点** → **ArtnetDeviceNode CH0** → **Artnet输出**
- **OSC输入** → **ArtnetDeviceNode CH1-CH7** → **灯光控制**
- **时间轴节点** → **ArtnetDeviceNode** → **场景控制**
- **布尔源节点** → **启用控制** → **远程开关设备**

## OSC控制

### 支持的OSC地址
- `/channels` - 设置通道数量
- `/startAddress` - 设置起始DMX地址
- `/enabled` - 设置启用状态（0=禁用，1=启用）
- `/ch0` 到 `/ch511` - 设置对应设备通道的值

### OSC消息格式
- 整数值：通道数量、起始地址、启用状态
- 浮点值：通道值（0.0-1.0，自动转换为0-255）

## 技术细节
- 启用/禁用状态实时影响输出数据生成
- 状态改变时立即触发数据更新信号
- 支持通过界面和OSC远程控制启用状态
- 禁用状态下通道设置值保持不变，仅输出被置零
- 节点配置保存包含启用状态信息

## 注意事项
1. 启用/禁用功能不影响通道值的设置和保存
2. 禁用状态下，所有通道输出固定为0值
3. 状态切换是实时的，适合现场演出控制
4. 建议在调试阶段使用禁用功能来隔离问题设备
5. 启用状态会随节点配置一起保存到项目文件中