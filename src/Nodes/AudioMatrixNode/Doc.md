# AudioMatrixNode 帮助文档

## 概述
AudioMatrixNode 是一个专业的音频矩阵混音节点，负责将多路输入音频信号通过可配置的矩阵进行混音处理，并输出到多个音频通道。支持实时音频处理和矩阵系数调整。

## 功能特性
- **多路音频混音**：支持多输入多输出的音频矩阵混音
- **实时处理**：基于多线程的实时音频数据处理
- **可视化矩阵控制**：通过GUI界面直观调整混音矩阵参数
- **幅度限制保护**：内置削波保护和幅度限制功能
- **高性能计算**：使用Eigen库进行优化的矩阵运算
- **时间戳同步**：基于TimestampGenerator的精确时间同步
- **数据持久化**：支持矩阵配置的保存和加载

## 输入端口
- **端口类型**：AudioData
- **端口数量**：6个（可配置）
- **数据格式**：支持AudioTimestampRingQueue共享缓冲区
- **音频格式**：16位有符号整数音频数据
- **采样率**：支持多种采样率（通常48kHz）
- **帧大小**：2048采样点/帧

## 输出端口
- **端口类型**：AudioData
- **端口数量**：8个（可配置）
- **数据格式**：16位有符号整数音频数据
- **处理延迟**：低延迟实时处理
- **幅度范围**：-32768到32767（16位整数范围）

## 界面组件
- **矩阵控制面板**：可视化的音频矩阵控制界面
- **FaderWidget控件**：每个矩阵元素对应一个推子控件
- **dB值显示**：显示范围-40dB到+10dB
- **实时参数调整**：支持鼠标拖拽和双击重置
- **矩阵尺寸**：6×8矩阵（输入×输出）

## 技术实现

### 核心组件
- **AudioMatrixWorker**：工作线程类，负责音频处理
- **AudioMatrixDataModel**：数据模型类，管理节点逻辑
- **MatrixWidget**：矩阵控制界面组件
- **FaderWidget**：单个推子控件

### 音频处理流程
1. **数据接收**：从输入端口接收AudioFrame数据
2. **格式转换**：将int16_t数据转换为float并归一化
3. **矩阵运算**：使用Eigen库进行高效矩阵乘法
4. **幅度限制**：应用削波保护和幅度限制
5. **格式还原**：将float数据转换回int16_t格式
6. **数据输出**：向输出端口发送处理后的音频数据

### 矩阵运算优化
```cpp
// 使用Eigen库进行批量矩阵运算
Eigen::MatrixXf inputMatrix(inputChannels, frameSize);
Eigen::MatrixXf outputMatrix = _matrix.transpose().cast<float>() * inputMatrix;
```

### 幅度限制算法
- **硬限幅**：防止音频信号溢出
- **预增益控制**：自动调整输入增益
- **削波保护**：避免数字失真

## 配置参数

### 矩阵参数
- **输入通道数**：6个
- **输出通道数**：8个
- **矩阵系数范围**：-40dB到+10dB
- **默认值**：-40dB（静音）

### 音频参数
- **采样率**：48kHz（推荐）
- **位深度**：16位
- **帧大小**：2048采样点
- **处理间隔**：实时处理

## 使用说明

### 基本操作
1. 将音频源连接到输入端口（0-5）
2. 通过矩阵界面调整各路音频的混音比例
3. 从输出端口（0-7）获取混音后的音频信号
4. 可以实时调整矩阵参数，立即生效

### 矩阵控制
- **鼠标拖拽**：上下拖动调整dB值
- **双击重置**：双击推子重置为0dB
- **数值显示**：推子上显示当前dB值
- **颜色指示**：推子高度表示信号强度

### 配置保存
- **自动保存**：矩阵配置自动保存到项目文件
- **JSON格式**：使用JSON格式存储矩阵数据
- **加载恢复**：项目加载时自动恢复矩阵配置

## 性能特性

### 优化特点
- **SIMD指令**：利用CPU SIMD指令加速运算
- **内存对齐**：优化内存访问模式
- **缓存友好**：减少内存访问延迟
- **多线程处理**：工作线程与UI线程分离

### 性能指标
- **处理延迟**：< 5ms
- **CPU占用**：< 5%（典型负载）
- **内存使用**：< 10MB
- **支持采样率**：8kHz - 192kHz

## 故障排除

### 常见问题
- **无音频输出**：检查矩阵系数是否为静音状态（-40dB）
- **音频失真**：调整矩阵系数，避免信号过载
- **延迟过大**：检查音频缓冲区设置
- **配置丢失**：确认项目文件保存正确

### 调试方法
- **启用调试输出**：查看qDebug()日志信息
- **监控音频电平**：观察输入输出信号强度
- **检查矩阵状态**：验证矩阵参数设置
- **测试单路信号**：逐个测试输入输出通道

## 技术限制

### 系统要求
- **操作系统**：Windows 10及以上
- **CPU**：支持SSE2指令集
- **内存**：至少4GB RAM
- **音频接口**：ASIO兼容音频设备（推荐）

### 使用限制
- **最大通道数**：输入6路，输出8路
- **最大采样率**：192kHz
- **最小缓冲区**：64采样点
- **最大延迟**：100ms

## 版本信息
- **当前版本**：1.0.0
- **依赖库**：Eigen3, Qt6, QtNodes
- **编译器**：MSVC 2022
- **更新日期**：2025年