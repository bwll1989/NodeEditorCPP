# NDVPlayerNode 帮助文档

## 节点功能
NDV播放器节点是一个抽象化的播放器控制节点，专门负责播放器逻辑和指令生成，支持以下特性：

- **播放器控制逻辑**：提供播放、停止、循环播放、上一个、下一个等播放器控制功能
- **指令生成**：将播放器操作转换为标准化的指令数据，传递给NDVControlNode执行
- **播放器ID管理**：支持设置播放器ID，用于多播放器环境下的设备识别
- **文件索引控制**：可指定要播放的节目文件索引（范围0-10）
- **状态输出**：实时输出播放器状态信息，包括当前文件、播放状态等
- **多输入触发**：支持通过多个输入端口触发不同播放控制命令
- **配置保存与加载**：自动保存和加载播放器设置
- **OSC远程控制**：支持通过OSC协议远程控制播放器功能

## 输入端口
节点提供了4个输入端口：

1. **INDEX**：文件索引值（整数类型，范围0-10）
2. **PLAY**：播放触发信号（布尔类型，true时触发播放，false时停止）
3. **STOP**：停止播放触发信号（布尔类型，true时触发停止播放）
4. **LOOP**：循环播放触发信号（布尔类型，true时触发循环播放）

## 输出端口
节点提供了2个输出端口：

1. **COMMAND**：指令输出（VariableData类型），包含指令类型、文件索引、目标ID等信息，需要连接到NDVControlNode
2. **STATUS**：播放器状态输出（VariableData类型），包含播放器ID、当前文件、播放状态等信息

## 节点界面
节点提供了直观的用户界面，包含以下元素：

- **播放器ID**：数字输入框，用于设置播放器的唯一标识符
- **文件索引**：数字输入框，用于设置要播放的节目文件索引（范围：0-10）
- **播放按钮**：点击触发播放指定索引的节目文件
- **停止按钮**：点击停止当前播放
- **循环播放按钮**：点击触发循环播放指定索引的节目文件
- **下一个按钮**：点击播放下一个文件
- **上一个按钮**：点击播放上一个文件

## 使用示例

### 基本播放器控制
1. 添加NDVPlayerNode到工作区
2. 设置播放器ID（如：1）
3. 设置要播放的节目文件索引（如：1）
4. 点击播放按钮开始播放
5. 需要停止时，点击停止按钮

### 与NDVControlNode配合使用
1. 添加NDVPlayerNode和NDVControlNode到工作区
2. 将NDVPlayerNode的COMMAND输出连接到NDVControlNode的输入端口
3. 在NDVControlNode中配置目标设备的IP地址和端口
4. 通过NDVPlayerNode控制播放，指令将自动传递给NDVControlNode执行

### 通过其他节点控制播放器
1. 将整数源节点（IntSourceNode）连接到NDVPlayerNode的INDEX端口
2. 将布尔源节点（BoolSourceNode）连接到NDVPlayerNode的PLAY端口
3. 当布尔源节点输出true时，NDVPlayerNode将自动播放整数源节点指定索引的节目文件

### 创建自动播放序列
1. 使用LFO节点生成周期性信号
2. 将LFO节点连接到逻辑操作节点，生成周期性的布尔值
3. 将布尔值连接到NDVPlayerNode的PLAY或LOOP端口
4. 使用整数源节点或计数器节点控制文件索引
5. 构建一个自动循环播放不同节目文件的系统

## 注意事项

- **节点配合**：NDVPlayerNode必须与NDVControlNode配合使用才能实现实际的设备控制
- **播放器ID**：在多播放器环境中，确保每个播放器节点使用不同的ID
- **文件索引**：确保指定的文件索引在目标NDV设备上存在
- **指令传递**：播放器节点只生成指令，实际的网络通信由NDVControlNode负责
- **状态监控**：可以通过STATUS输出端口监控播放器的实时状态
- **OSC控制**：节点支持通过以下OSC地址远程控制：
  - `/play`：触发播放
  - `/stop`：触发停止
  - `/loop`：触发循环播放
  - `/next`：播放下一个文件
  - `/prev`：播放上一个文件
  - `/index`：设置文件索引
- **配置保存**：播放器ID和文件索引设置会自动保存到流程文件中

## 技术细节

- **数据类型**：使用VariableData作为输入输出数据类型
- **指令格式**：生成包含指令类型、文件索引、目标ID、时间戳等信息的结构化数据
- **状态管理**：实时维护播放器状态（Playing、Stopped、Loop Playing等）
- **界面框架**：基于Qt Widgets构建，使用自定义的NDVPlayerInterface
- **OSC支持**：通过NodeDelegateModel::registerOSCControl注册OSC控制接口
- **配置持久化**：使用QJsonObject实现配置的保存和加载
- **信号槽机制**：使用Qt的信号槽机制处理界面交互和数据更新