# Count 节点文档
## 节点功能
计数节点（Count Node）用于根据JavaScript表达式条件对数据进行计数，支持以下特性：

- 条件计数：根据JavaScript表达式的结果（true/false）增加计数器值
- 灵活表达式：通过文本输入框可以动态指定JavaScript表达式
- 全局变量支持：输入数据自动注册为JavaScript全局变量 $input ，方便在表达式中引用
- 嵌套数据访问：可以使用点表示法访问嵌套数据结构中的值（如 $input.data.position.x > 100 ）
- 计数器重置：提供清除按钮，可随时重置计数器值
- 实时数据更新：当输入数据或表达式变化时，自动更新计数结果
- 配置保存与加载：支持将表达式和计数值保存到流程文件中并在加载时恢复
- 嵌入式界面：提供简洁的嵌入式界面，方便直接在节点上编辑表达式和重置计数
## 输入端口
节点提供1个输入端口：

1. INPUT 0：数据输入源，接收VariableData类型的数据
## 输出端口
节点提供1个输出端口：

1. OUTPUT 0：计数结果，输出当前计数值（整数）
## 节点界面
节点界面包含两个组件：

1. 文本输入框：用于输入JavaScript表达式，默认值为"default"
2. 清除按钮：点击后重置计数器为0
## 使用示例
### 示例1：基本条件计数
1. 添加计数节点到流程图
2. 将一个数据源节点（如IntSourceNode或MergeNode）连接到计数节点的输入端口
3. 在文本框中输入条件表达式，例如 $input.value > 10
4. 每当输入数据满足条件（值大于10）时，计数器会加1
### 示例2：复杂数据结构条件计数
1. 添加计数节点到流程图
2. 将一个包含嵌套数据的VariableData源节点连接到计数节点的输入端口
3. 在文本框中输入条件表达式，例如 $input.position.x > 100 && $input.position.y < 200
4. 每当输入数据的位置坐标满足条件时，计数器会加1
### 示例3：事件计数
1. 添加计数节点到流程图
2. 将一个事件源节点（如HotKeyNode或OscInNode）连接到计数节点的输入端口
3. 在文本框中输入条件表达式，例如 $input.triggered === true
4. 每当事件被触发时，计数器会加1
### 示例4：计数器重置
1. 在任何时候，点击节点界面上的"clear"按钮
2. 计数器将被重置为0
## 注意事项
1. 输入数据必须是VariableData类型，否则节点将无法处理
2. JavaScript表达式必须返回布尔值（true/false），否则计数逻辑可能不符合预期
3. 表达式中可以直接使用 $input 变量访问输入数据
4. 表达式区分大小写，确保输入的表达式语法正确
5. 文本框中的更改会在编辑完成后（按Enter键或失去焦点）立即生效
6. 节点配置（表达式和计数值）会随流程文件一起保存和加载
7. 当输入数据为空时，节点将保持当前计数值不变
## 技术细节
- 节点使用QLineEdit实现表达式输入界面
- 使用QPushButton实现计数器重置功能
- 使用QJSEngine执行JavaScript表达式
- 通过JSEngineDefines命名空间中的函数在C++和JavaScript之间转换数据
- 使用QJsonObject保存和加载配置数据和计数值
- 通过信号槽机制实现表达式变化和计数器重置时的实时更新
- 支持通过dataUpdated信号通知下游节点数据已更新