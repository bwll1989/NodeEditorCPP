# FileLoadNode 插件说明

## 概述
FileLoadNode 插件用于从媒体库中加载各类文件，并将内容以节点输出的形式提供给后续处理。当前包含以下数据模型：
- JSON File：解析 JSON 文档并输出结构化数据
- INI File：解析 INI 配置并输出层级/扁平化数据
- Image File：加载图片并输出图像数据
- CSV File（可选）：解析 CSV 表格并输出表头与行数据（默认未启用）

插件信息：
- 名称：`File Load Node`
- 标签：`Controls`
- 描述：`导入文件（JSON、CSV、INI、Image）`

> 注意：CSV 节点已实现但默认未注册。如需启用，请在 `PluginDefinition.cpp` 中取消注释：
> `// reg->registerModel<Nodes::CsvLoaderModel>("Csv File",tag());`

---

## JSON File 节点
- 功能：从媒体库选择并加载 JSON 文档，解析为对象或数组输出。
- 输入端口：0
- 输出端口：1
  - 类型：`VariableData`
  - 内容：
    - 若根为对象：直接输出对象的键值
    - 若根为数组：将数组保存到默认键 `default`（类型为 `QVariantList`），便于下游通过 `json()` 获得数组
- 节点界面：嵌入式文件选择控件（文档类目录）
- 保存/加载：
  - `save()` 持久化当前选中文件路径到图中
  - `load()` 按持久化路径自动加载并解析
- 错误处理：
  - 文件不存在或无法打开、解析错误会更新节点校验状态为错误并清空输出
- OSC 反馈：
  - 节点内部保持与 OSC 的状态反馈逻辑（地址为 `/dataflow/{alias}/{nodeId}/...`）

使用步骤：
1. 在节点面板中添加“JSON File”节点
2. 通过下拉或输入选择媒体库中的 JSON 文件
3. 将输出端口连接到需要消费数据的节点（如脚本或数据处理节点）

---

## INI File 节点
- 功能：解析 INI 配置文件，输出结构化键值数据。
- 输入端口：0
- 输出端口：1
  - 类型：`VariableData`
  - 常见约定：
    - 根键（未在任何分组下）归于 `global` 分组，或直接以默认映射输出
    - 各分组键按组名组织为嵌套映射
    - 可额外提供一个扁平化映射（`group.key` 形式）于默认键，便于查找
- 节点界面：嵌入式文件选择控件（文档类目录）
- 保存/加载：支持持久化路径并在加载时自动解析
- 错误处理：文件不存在或解析失败时输出为空并标记错误

使用步骤：
1. 添加“INI File”节点
2. 选择媒体库中的 INI 文件
3. 将输出连接到需要读取配置的节点

---

## Image File 节点
- 功能：从媒体库加载图片资源。
- 输入端口：0
- 输出端口：1
  - 类型：`ImageData`
  - 内容：加载后的图像（如 `QImage`）
- 节点界面：嵌入式文件选择控件（图片目录）
- 保存/加载：支持持久化所选图片路径
- 错误处理：文件不存在或无法读取时输出为空并标记错误

使用步骤：
1. 添加“Image File”节点
2. 选择媒体库中的图片文件
3. 将输出连接到图像处理或显示节点

---

## CSV File 节点（如启用）
- 功能：解析 CSV 文本，输出表头与数据行。
- 输入端口：0
- 输出端口：1
  - 类型：`VariableData`
  - 内容约定：
    - `headers`：`QVariantList`，首行字段名
    - `rows`：`QVariantList`（每行为 `QVariantList`），数据行
    - `default`：同 `rows`，提供常用数据访问
- 节点界面：嵌入式文件选择控件（文档类目录）
- 保存/加载：支持持久化路径与自动解析
- 错误处理：无法打开或解析失败时清空输出并标记错误

> 若 CSV 文件包含 UTF-8 BOM，会自动剔除后再解析；解析遵循 RFC4180 规则，支持带引号的字段与逗号分隔。

---

## 常见问题
- 文件路径来源：节点使用应用的媒体库目录 `AppConstants::MEDIA_LIBRARY_STORAGE_DIR` 作为根目录进行路径解析。
- 解析为空的情况：
  - 文件为空、路径不存在、格式错误或不符合预期（例如非对象/数组的 JSON 根）
  - 节点会清空输出并在 UI 显示错误状态
- 兼容性：文档节点统一在无输入端口的情况下提供数据，便于作为数据源放入流程图起始位置。

## 版本
- 插件版本：由构建系统注入 `PLUGIN_VERSION`（如未注入则显示为 `dev`）
- 组成：`JsonLoaderModel.hpp`、`IniLoaderModel.hpp`、`ImageLoaderModel.hpp`、`CsvLoaderModel.hpp`、`PluginDefinition.hpp/.cpp`