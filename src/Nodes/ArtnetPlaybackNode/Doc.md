# ArtnetPlaybackNode 帮助文档

## 概述

ArtnetPlaybackNode 是一个专业的视频播放节点，用于播放HAP编码的视频文件并将视频像素数据转换为DMX数据输出。该节点支持标准Artnet协议的Universe、Subnet、Net寻址，提供完整的播放控制功能，并支持循环播放和远程控制。

**主要特性**：
- 支持HAP编码视频文件播放
- 自动将视频像素转换为DMX数据
- 支持标准Artnet协议寻址（Universe、Subnet、Net）
- 提供完整的播放控制（播放、停止、循环）
- 支持输入端口远程控制
- 支持OSC远程控制
- 实时视频信息显示
- 数据清空功能

## 功能说明

### 视频播放机制
- **HAP编码支持**：专为HAP编码视频优化，确保最佳性能
- **像素映射**：将视频像素RGB值转换为DMX通道数据
- **帧率控制**：固定25fps播放，确保稳定的DMX输出
- **尺寸要求**：视频宽度必须为128像素，高度决定Universe数量
- **自动Universe计算**：根据视频高度自动调整输出Universe数量

### 循环播放功能
- **循环复选框**：界面提供循环播放开关控制
- **无缝循环**：视频播放结束时自动回到开头继续播放
- **状态保存**：循环状态可保存到项目文件中
- **远程控制**：支持通过输入端口和OSC控制循环状态

### 播放控制
- **播放按钮**：开始视频播放
- **停止按钮**：停止视频播放并重置到开头
- **循环播放**：启用循环模式后自动重复播放
- **文件选择**：支持选择HAP编码的视频文件
- **清空数据**：清空当前DMX输出数据

### Artnet协议支持
- **Universe寻址**：支持Universe (0-15)、Subnet (0-15)、Net (0-127)
- **完整地址**：自动计算完整Universe地址 = (Net << 8) | (Subnet << 4) | Universe
- **多Universe输出**：根据视频高度自动输出多个Universe
- **512通道**：每个Universe固定输出512个DMX通道数据

## 端口配置

### 输入端口
- **播放** (端口0)：接收播放触发信号
- **循环播放** (端口1)：接收循环播放触发信号
- **停止** (端口2)：接收停止播放信号
- **清除数据** (端口3)：接收清空数据信号

### 输出端口（动态）
- **UNIVERSE0-N**：根据视频高度动态生成的Universe输出端口
  - 每个端口输出完整的Artnet Universe数据包
  - 包含协议头信息、Universe寻址信息、512通道DMX数据
  - 包含统计信息和时间戳

## 界面说明

### Universe配置
- **Universe**：Universe编号设置 (0-15)
- **Subnet**：Subnet编号设置 (0-15)
- **Net**：Net编号设置 (0-127)

### 视频文件控制
- **选择文件**：选择HAP编码的视频文件
- **文件名显示**：显示当前选择的文件名
- **视频信息**：显示视频尺寸、帧率、时长等信息

### 播放控制
- **播放按钮**：开始播放视频
- **停止按钮**：停止播放并重置到开头
- **循环播放复选框**：启用/禁用循环播放模式
- **清空数据按钮**：清空当前DMX输出数据

### 状态显示
- **播放状态**：显示当前播放状态（播放中/已停止）
- **视频信息**：实时显示视频参数
- **错误信息**：显示文件加载或播放错误

## 使用示例

### 示例1：基本视频播放
1. 点击"选择文件"按钮选择HAP编码视频
2. 设置Universe、Subnet、Net参数
3. 点击"播放"按钮开始播放
4. 视频像素数据自动转换为DMX输出

### 示例2：循环播放设置
1. 选择视频文件并设置Universe参数
2. 勾选"循环播放"复选框
3. 点击"播放"按钮
4. 视频将无限循环播放直到手动停止

### 示例3：远程控制播放
1. 连接其他节点到ArtnetPlaybackNode的输入端口
2. 通过输入端口0发送信号触发播放
3. 通过输入端口1发送信号启用循环播放
4. 通过输入端口2发送信号停止播放

### 示例4：与ArtnetOut节点配合
1. **ArtnetPlayback** → **ArtnetOut** → **网络广播**
2. Playback节点负责视频播放和DMX数据生成
3. Out节点负责网络传输
4. 可实现视频内容的网络分发

## OSC控制

### 支持的OSC地址
- `/play` - 开始播放（发送任意值触发）
- `/stop` - 停止播放（发送任意值触发）
- `/loop` - 切换循环模式（发送1启用，0禁用）
- `/clear` - 清空数据（发送任意值触发）


### OSC消息格式
- 整数值：Universe、Subnet、Net设置
- 布尔值：循环模式控制
- 触发操作：发送任意数值到对应地址即可触发

## 技术细节

### 视频处理
- 使用FFmpeg 7.1进行视频解码
- 支持HAP、HAP Alpha、HAP Q编码格式
- 固定25fps播放帧率
- 视频宽度必须为128像素
- 像素RGB值直接映射到DMX通道

### 循环播放实现
- 播放结束时使用av_seek_frame()重新定位到文件开头
- 清空解码器缓冲区确保无缝循环
- 循环状态通过isLooping变量控制
- 支持界面复选框和输入端口控制

### 数据保存
- 保存Universe、Subnet、Net设置
- 保存循环播放状态
- 保存视频文件路径
- 保存视频信息（尺寸、帧率、时长等）

## 注意事项

1. **视频格式要求**：
   - 必须使用HAP编码格式
   - 视频宽度必须为128像素
   - 建议使用HAP编码以获得最佳性能

2. **性能考虑**：
   - 高分辨率视频会产生大量DMX数据
   - 建议根据实际需求选择合适的视频尺寸
   - 25fps固定帧率确保稳定的DMX输出

3. **循环播放**：
   - 循环播放会持续占用系统资源
   - 长时间循环播放建议监控系统性能
   - 可通过停止按钮或输入端口随时停止

4. **网络传输**：
   - 多Universe输出会增加网络负载
   - 建议配合ArtnetOut节点进行网络分发
   - 注意网络带宽和延迟影响

5. **文件管理**：
   - 项目保存时会记录视频文件路径
   - 移动项目文件时需确保视频文件路径正确
   - 支持相对路径和绝对路径